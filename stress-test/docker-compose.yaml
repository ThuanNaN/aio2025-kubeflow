version: '3.8'

services:
  stress-test:
    build: .
    image: yolo-stress-test:latest
    container_name: yolo-stress-test
    ports:
      - "8089:8089"  # Locust web UI
    volumes:
      - ./results:/app/results
      - ./config.yaml:/app/config.yaml
    environment:
      - TARGET_URL=${TARGET_URL:-http://backend:8000}
    networks:
      - stress-test-network
    # Override command for different modes:
    # Locust web UI (default):
    # command: locust -f stress_test.py --web-host 0.0.0.0 --web-port 8089
    
    # Locust headless:
    # command: locust -f stress_test.py --host http://backend:8000 --headless -u 20 -r 5 -t 5m
    
    # Async benchmark:
    # command: python benchmark_async.py --env docker --profile standard

networks:
  stress-test-network:
    driver: bridge
